<?xml version="1.0" encoding="utf-8"?><!DOCTYPE nta PUBLIC '-//Uppaal Team//DTD Flat System 1.1//EN' 'http://www.it.uu.se/research/group/darts/uppaal/flat-1_1.dtd'><nta><declaration>// Place global declarations here.

//urgent channels
urgent chan emergencyStop;

//channels
chan emergencyStopButton;
chan pollSensors;
chan pollWater;
chan pollSteam;
chan resetPump; 
chan releasePump1;
chan releasePump2; 
chan activatePump;
chan reset;
chan waterOK;
chan stopPump;
chan choosePump;

//integer variables
int w2 = 75;
int w1 = 25;
int w = 50;
int s = 30; 
int sMAX = 60; 
int polls; 

//boolean variables
bool pump1Broken = 0;
bool pump2Broken =0;

</declaration><template><name x="5" y="5">Controller</name><declaration>// Place local declarations here.
clock y;</declaration><location id="id0" x="-552" y="-344"><name x="-704" y="-352">GENERATE_STEAM</name></location><location id="id1" x="-392" y="-240"><name x="-376" y="-248">RELEASE_STEAM</name></location><location id="id2" x="-552" y="-240"><name x="-688" y="-248">STEAM_MANAGE</name></location><location id="id3" x="88" y="-160"><name x="16" y="-144">PRESS_EMERGENCY_STOP</name></location><location id="id4" x="-328" y="-96"><name x="-312" y="-112">STOP_PUMP</name></location><location id="id5" x="-432" y="24"><name x="-480" y="40">START_PUMP</name><committed/></location><location id="id6" x="-104" y="24"></location><location id="id7" x="88" y="-344"><name x="48" y="-384">SHUT_DOWN</name></location><location id="id8" x="-104" y="-160"></location><location id="id9" x="-104" y="-344"></location><location id="id10" x="-392" y="-344"><name x="-402" y="-374">idle</name></location><init ref="id10"/><transition><source ref="id2"/><target ref="id1"/><label kind="guard" x="-512" y="-240">s &gt;= sMAX - 10</label></transition><transition><source ref="id2"/><target ref="id0"/><label kind="guard" x="-648" y="-304">s &lt; sMAX - 10</label></transition><transition><source ref="id1"/><target ref="id10"/><label kind="assignment" x="-384" y="-304">s--</label></transition><transition><source ref="id0"/><target ref="id10"/><label kind="assignment" x="-480" y="-368">s++</label></transition><transition><source ref="id3"/><target ref="id7"/><label kind="synchronisation" x="96" y="-256">emergencyStopButton!</label></transition><transition><source ref="id4"/><target ref="id2"/><label kind="synchronisation" x="-400" y="-160">stopPump!</label></transition><transition><source ref="id6"/><target ref="id4"/><label kind="guard" x="-312" y="-56">w &lt; w1 + 10 || w &gt; w2 - 10</label></transition><transition><source ref="id5"/><target ref="id2"/><label kind="synchronisation" x="-656" y="-56">releasePump2!</label><nail x="-552" y="24"/><nail x="-552" y="-176"/></transition><transition><source ref="id5"/><target ref="id2"/><label kind="synchronisation" x="-472" y="-88">releasePump1!</label><nail x="-440" y="8"/></transition><transition><source ref="id6"/><target ref="id5"/><label kind="guard" x="-320" y="32">w &gt;= w1 - 10 &amp;&amp; w &lt;= w2 - 10</label><label kind="synchronisation" x="-328" y="0">choosePump!</label><nail x="-232" y="24"/></transition><transition><source ref="id8"/><target ref="id6"/><label kind="synchronisation" x="-96" y="-80">waterOK?</label></transition><transition><source ref="id9"/><target ref="id7"/><label kind="guard" x="-48" y="-368">polls == 5</label><label kind="synchronisation" x="-64" y="-336">emergencyStop!</label></transition><transition><source ref="id9"/><target ref="id8"/><label kind="synchronisation" x="-96" y="-264">pollWater!</label></transition><transition><source ref="id10"/><target ref="id9"/><label kind="synchronisation" x="-296" y="-368">pollSensors!</label></transition></template><template><name>Sensor</name><declaration>clock x;</declaration><location id="id11" x="-984" y="-480"><committed/></location><location id="id12" x="-1352" y="-168"><name x="-1448" y="-176">STEAM_OK</name></location><location id="id13" x="-832" y="-320" color="#ffa500"><name x="-816" y="-328">STOP</name></location><location id="id14" x="-832" y="-168"><name x="-872" y="-200">STEAM_ERROR</name></location><location id="id15" x="-832" y="-480"><name x="-864" y="-512">WATER_ERROR</name></location><location id="id16" x="-984" y="-168"></location><location id="id17" x="-984" y="-312"><name x="-968" y="-320">WATER_OK</name></location><location id="id18" x="-1120" y="-480"><name x="-1184" y="-528">SENSORS_CHECKED</name></location><location id="id19" x="-1352" y="-480"><name x="-1360" y="-512">idle</name><label kind="invariant" x="-1432" y="-488">polls &lt;= 1</label></location><init ref="id19"/><transition><source ref="id11"/><target ref="id19"/><label kind="guard" x="-1192" y="-424">x &gt;= 5</label><label kind="assignment" x="-1272" y="-424">polls ++</label><nail x="-1096" y="-424"/><nail x="-1280" y="-424"/></transition><transition><source ref="id16"/><target ref="id12"/><label kind="guard" x="-1200" y="-160">s &lt;= sMAX</label></transition><transition><source ref="id18"/><target ref="id11"/><label kind="synchronisation" x="-1088" y="-480">pollWater?</label><label kind="assignment" x="-1072" y="-504">x = 0</label></transition><transition><source ref="id12"/><target ref="id19"/></transition><transition><source ref="id14"/><target ref="id13"/><label kind="synchronisation" x="-824" y="-264">emergencyStop!</label></transition><transition><source ref="id15"/><target ref="id13"/><label kind="synchronisation" x="-824" y="-416">emergencyStop!</label></transition><transition><source ref="id16"/><target ref="id14"/><label kind="guard" x="-944" y="-192">s &gt; sMAX</label></transition><transition><source ref="id11"/><target ref="id15"/><label kind="guard" x="-960" y="-472">w &gt; w2 || w &lt; w1</label><nail x="-912" y="-480"/></transition><transition><source ref="id17"/><target ref="id16"/><label kind="synchronisation" x="-1048" y="-256">waterOK!</label></transition><transition><source ref="id11"/><target ref="id17"/><label kind="guard" x="-1120" y="-400">w &gt;= w1 &amp;&amp; w &lt;= w2</label></transition><transition><source ref="id19"/><target ref="id18"/><label kind="guard" x="-1328" y="-504">w1 &lt;= w &lt;= w2 &amp;&amp; s &lt;= sMAX</label><label kind="synchronisation" x="-1280" y="-480">pollSensors?</label></transition></template><template><name>Boiler</name><location id="id20" x="192" y="-32"><name x="120" y="-80">EMERGENCY_STOP_BUTTON</name></location><location id="id21" x="-32" y="-32" color="#ffa500"><name x="-104" y="-16">EMERGENCY_STOP</name></location><location id="id22" x="-256" y="-32"><name x="-266" y="-62">idle</name></location><init ref="id22"/><transition><source ref="id20"/><target ref="id21"/><label kind="synchronisation" x="8" y="-56">emergencyStopButton?</label></transition><transition><source ref="id22"/><target ref="id21"/><label kind="synchronisation" x="-200" y="-56">emergencyStop?</label></transition></template><template><name>Pump</name><location id="id23" x="-256" y="-16"><name x="-240" y="-16">PUMP_2</name></location><location id="id24" x="-256" y="-112"><name x="-240" y="-128">PUMP_1</name></location><location id="id25" x="-48" y="-64"><name x="-24" y="-72">PUMP_FINISHED</name></location><location id="id26" x="-432" y="-64"><name x="-456" y="-56">idle</name></location><init ref="id26"/><transition><source ref="id26"/><target ref="id26"/><label kind="synchronisation" x="-512" y="-128">stopPump?</label><label kind="assignment" x="-568" y="-88">w--</label><nail x="-544" y="-128"/><nail x="-544" y="-32"/></transition><transition><source ref="id25"/><target ref="id26"/><nail x="-48" y="184"/><nail x="-432" y="184"/><nail x="-432" y="24"/></transition><transition><source ref="id24"/><target ref="id26"/><label kind="guard" x="-408" y="-136">pump1Broken == 1</label><nail x="-432" y="-112"/></transition><transition><source ref="id23"/><target ref="id26"/><label kind="guard" x="-408" y="-8">pump2Broken == 1</label><nail x="-432" y="-16"/></transition><transition><source ref="id23"/><target ref="id25"/></transition><transition><source ref="id24"/><target ref="id25"/></transition><transition><source ref="id23"/><target ref="id23"/><label kind="guard" x="-288" y="136">!pump2Broken</label><label kind="synchronisation" x="-216" y="56">releasePump2?</label><label kind="assignment" x="-312" y="56">w++</label><nail x="-192" y="136"/><nail x="-296" y="136"/></transition><transition><source ref="id24"/><target ref="id24"/><label kind="guard" x="-288" y="-288">!pump1Broken</label><label kind="synchronisation" x="-200" y="-216">releasePump1?</label><label kind="assignment" x="-320" y="-216">w++</label><nail x="-184" y="-264"/><nail x="-304" y="-264"/></transition><transition><source ref="id26"/><target ref="id23"/><label kind="synchronisation" x="-400" y="-40">choosePump?</label><nail x="-384" y="-64"/><nail x="-256" y="-64"/></transition><transition><source ref="id26"/><target ref="id24"/><label kind="synchronisation" x="-400" y="-88">choosePump?</label><nail x="-256" y="-64"/></transition></template><system>// Place template instantiations here.

Controller1 = Controller();
Sensor1 = Sensor();
Boiler1 = Boiler();
Pump1 = Pump(); 

// List one or more processes to be composed into a system.
system Controller1, Sensor1, Boiler1, Pump1; </system></nta>